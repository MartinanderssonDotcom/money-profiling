<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_77) on Fri Jul 22 23:12:22 EDT 2016 -->
<title>ReadJsonNumberBenchmark (Money Profiling API)</title>
<meta name="date" content="2016-07-22">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="ReadJsonNumberBenchmark (Money Profiling API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/martinandersson/money/benchmark/ReadFastMoneyNumberBenchmark.html" title="class in com.martinandersson.money.benchmark"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../com/martinandersson/money/benchmark/ReadMoneyNumberBenchmark.html" title="class in com.martinandersson.money.benchmark"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/martinandersson/money/benchmark/ReadJsonNumberBenchmark.html" target="_top">Frames</a></li>
<li><a href="ReadJsonNumberBenchmark.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.martinandersson.money.benchmark</div>
<h2 title="Class ReadJsonNumberBenchmark" class="title">Class ReadJsonNumberBenchmark</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>com.martinandersson.money.benchmark.ReadJsonNumberBenchmark</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">ReadJsonNumberBenchmark</span>
extends java.lang.Object</pre>
<div class="block">Will profile different ways of acquiring/reading the numeric value from a
 <code>JsonNumber</code><p>
 
 More specifically, this benchmark will profile how to get the numeric value
 from the reference implementation "JSON Processing" (JSONP). The API (JSR
 353) provide no elegant way to do so.<p>
 
 The source code of the reference implementation is located here:
 <pre>
   https://java.net/projects/jsonp/sources/git/content/impl/src/main/java/org/glassfish/json/JsonNumberImpl.java
 </pre>
 
 If you study this source code file, you shall find that JSONP has only three
 implementations that internally wrap three different number types: int, long
 and BigDecimal<sup>1</sup>.<p>
 
 High-performance code will most likely prefer to deal with an int before a
 long, and a long before a BigDecimal. There's not much point in using a
 BigDecimal unless we have to.<p>
 
 The API itself has "BigDecimal semantics" written all over it and is not
 very useful for us. In fact, both API as well as the reference implementation
 is mind-boggling stupid (my humor). For example, JavaDoc of
 <code>JsonNumber.isIntegral()</code> as well as JSONP's implementation do this:
 <pre>
   bd.scale() == 0;
 </pre>
 
 A less mind-boggling stupid implementation would have been something more
 like this:
 <pre>
   bd.signum() == 0 || bd.scale()  &lt;= 0  || bd.stripTrailingZeros().scale()  &lt;= 0;
 </pre>
 
 This check risk creating an extra BigDecimal object but at least it will
 answer the question truthfully and client now have a real option - moving
 forward - to only use a primitive type versus being forced to use a complex
 type (BigDecimal)<sup>2</sup>. If the number is integral, then it should
 "most likely" fit an int or a long.<p>
 
 Our real problem, however, is that JSONP's implementation that store a long
 under the cover will go the long way through a BigDecimal if you ask for an
 int value instead of using <code>Math.toIntExact()</code><sup>3</sup>.<p>
 
 At the end of the day, there is no way to gracefully ask for an int or a long
 without also risk having a BigDecimal constructed under the cover.<p>
 
 So what can we do about it? The benchmarks in this class profile a few
 alternatives I came up with. They are grouped in two categories: "api" and
 "impl".<p>
 
 "Api" benchmarks try to work their magic using the JSON API only. "Impl"
 benchmarks are allowed to (and will) query for the implementation one way or
 the other in order to make a smart method dispatch. Please feel free to GIT
 push if you have any other ideas.
 
 
 
 <h3>Results</h3>
 
 Results on author's machine showed that <a href="../../../../com/martinandersson/money/benchmark/ReadJsonNumberBenchmark.html#api_trycatch-org.openjdk.jmh.infra.Blackhole-"><code>api_trycatch()</code></a> was the fastest alternative for int numbers. But if the
 internal number was a long or a BigDecimal, then "try-catch" fell far behind
 and was many times slower than the next worst alternative.<p>
 
 <a href="../../../../com/martinandersson/money/benchmark/ReadJsonNumberBenchmark.html#impl_refcheck-org.openjdk.jmh.infra.Blackhole-"><code>impl_refcheck()</code></a> was almost as fast as
 "try-catch" for ints, and it was the fastest alternative for longs.<p>
 
 <a href="../../../../com/martinandersson/money/benchmark/ReadJsonNumberBenchmark.html#api_bigdecimal-org.openjdk.jmh.infra.Blackhole-"><code>api_bigdecimal()</code></a> was the fastest
 alternative for doubles, but "ref-check" wasn't far behind.<p>
 
 I have to proclaim the winner to be "ref-check" which will almost be as fast
 as "bigdecimal" for doubles, but will yield better performance than
 "bigdecimal" in terms of speed and garbage for ints and longs.
 
 
 
 <h3>Notes</h3>
 
 1: As is easy to understand, the underlying source is pure text. If this is a
 "floating-point" value, The BigDecimal is going to "exactly" represent the
 floating-point value read. For example, "0.1" and not the double value
 0.1d which cannot be represented exactly.<p>
 
 2: This evaluates to <code>true</code>:
 <pre>
     new BigDecimal(1).equals(new BigDecimal(1.0D))
 </pre>
 
 In this case, both instances has precision = 1 and scale = 0. I.e.,
 JavaDoc and JSONP both claim both instances are integral and indeed,
 both instances can be used to retrieve the exact int value without exceptions
 fucking us up.<p>
 
 However, this evaluates to <code>false</code>:
 <pre>
     new BigDecimal(1).equals(new BigDecimal("1.0"))
 </pre>
 
 In full compliance with BigDecimal JavaDoc for the String accepting
 constructor, this cause precision to go from 1 to 2, and scale from 0
 to 1.<p>
 
 Thusly, for a BigDecimal constructed from the String "1.0", JavaDoc
 and JSONP would both say this guy is NOT integral. However, <code>intValueExact()</code> will still be able to produce the exact int value 1 without
 any fuss.<p>
 
 3: See https://java.net/jira/browse/JSONP-35</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../com/martinandersson/money/benchmark/ReadJsonNumberBenchmark.html#ReadJsonNumberBenchmark--">ReadJsonNumberBenchmark</a></span>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>java.math.BigDecimal</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/martinandersson/money/benchmark/ReadJsonNumberBenchmark.html#api_bigdecimal-org.openjdk.jmh.infra.Blackhole-">api_bigdecimal</a></span>(org.openjdk.jmh.infra.Blackhole&nbsp;hole)</code>
<div class="block">This guy has lost hope and will always call for the BigDecimal.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/martinandersson/money/benchmark/ReadJsonNumberBenchmark.html#api_trycatch-org.openjdk.jmh.infra.Blackhole-">api_trycatch</a></span>(org.openjdk.jmh.infra.Blackhole&nbsp;hole)</code>
<div class="block">This guy features tons of try-catches in order to desperately night hack
 his way to success.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>javax.json.JsonNumber</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/martinandersson/money/benchmark/ReadJsonNumberBenchmark.html#baseline--">baseline</a></span>()</code>
<div class="block">Baseline return <code>number</code>.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/martinandersson/money/benchmark/ReadJsonNumberBenchmark.html#impl_charcheck_ifelse-org.openjdk.jmh.infra.Blackhole-">impl_charcheck_ifelse</a></span>(org.openjdk.jmh.infra.Blackhole&nbsp;hole)</code>
<div class="block">This is an alternative of the former where we have replaced the
 switch-block with tons of if-else instead.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/martinandersson/money/benchmark/ReadJsonNumberBenchmark.html#impl_charcheck_switch-org.openjdk.jmh.infra.Blackhole-">impl_charcheck_switch</a></span>(org.openjdk.jmh.infra.Blackhole&nbsp;hole)</code>
<div class="block">This is a variation of the former where we simply pull a char from the
 class name and make irresponsible assumptions.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/martinandersson/money/benchmark/ReadJsonNumberBenchmark.html#impl_refcheck-org.openjdk.jmh.infra.Blackhole-">impl_refcheck</a></span>(org.openjdk.jmh.infra.Blackhole&nbsp;hole)</code>
<div class="block">This guy compare actual implementation classes and call methods
 accordingly.</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/martinandersson/money/benchmark/ReadJsonNumberBenchmark.html#init--">init</a></span>()</code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="ReadJsonNumberBenchmark--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ReadJsonNumberBenchmark</h4>
<pre>public&nbsp;ReadJsonNumberBenchmark()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="init--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>init</h4>
<pre>public&nbsp;void&nbsp;init()</pre>
</li>
</ul>
<a name="baseline--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>baseline</h4>
<pre>public&nbsp;javax.json.JsonNumber&nbsp;baseline()</pre>
<div class="block">Baseline return <code>number</code>.<p>
 
 All other benchmarks in this class will try different ways to figure out
 what underlying number implementation we are working with.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd><code>number</code></dd>
</dl>
</li>
</ul>
<a name="api_trycatch-org.openjdk.jmh.infra.Blackhole-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>api_trycatch</h4>
<pre>public&nbsp;void&nbsp;api_trycatch(org.openjdk.jmh.infra.Blackhole&nbsp;hole)</pre>
<div class="block">This guy features tons of try-catches in order to desperately night hack
 his way to success.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>hole</code> - black hole provided by JHM</dd>
</dl>
</li>
</ul>
<a name="api_bigdecimal-org.openjdk.jmh.infra.Blackhole-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>api_bigdecimal</h4>
<pre>public&nbsp;java.math.BigDecimal&nbsp;api_bigdecimal(org.openjdk.jmh.infra.Blackhole&nbsp;hole)</pre>
<div class="block">This guy has lost hope and will always call for the BigDecimal.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>hole</code> - black hole provided by JHM</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a BigDecimal</dd>
</dl>
</li>
</ul>
<a name="impl_refcheck-org.openjdk.jmh.infra.Blackhole-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>impl_refcheck</h4>
<pre>public&nbsp;void&nbsp;impl_refcheck(org.openjdk.jmh.infra.Blackhole&nbsp;hole)</pre>
<div class="block">This guy compare actual implementation classes and call methods
 accordingly.<p>
 
 Please note that the implementation classes are cached as I suspect that
 is exactly what would happen in the real life too.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>hole</code> - black hole provided by JHM</dd>
</dl>
</li>
</ul>
<a name="impl_charcheck_switch-org.openjdk.jmh.infra.Blackhole-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>impl_charcheck_switch</h4>
<pre>public&nbsp;void&nbsp;impl_charcheck_switch(org.openjdk.jmh.infra.Blackhole&nbsp;hole)</pre>
<div class="block">This is a variation of the former where we simply pull a char from the
 class name and make irresponsible assumptions.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>hole</code> - black hole provided by JHM</dd>
</dl>
</li>
</ul>
<a name="impl_charcheck_ifelse-org.openjdk.jmh.infra.Blackhole-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>impl_charcheck_ifelse</h4>
<pre>public&nbsp;void&nbsp;impl_charcheck_ifelse(org.openjdk.jmh.infra.Blackhole&nbsp;hole)</pre>
<div class="block">This is an alternative of the former where we have replaced the
 switch-block with tons of if-else instead.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>hole</code> - black hole provided by JHM</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/martinandersson/money/benchmark/ReadFastMoneyNumberBenchmark.html" title="class in com.martinandersson.money.benchmark"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../com/martinandersson/money/benchmark/ReadMoneyNumberBenchmark.html" title="class in com.martinandersson.money.benchmark"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/martinandersson/money/benchmark/ReadJsonNumberBenchmark.html" target="_top">Frames</a></li>
<li><a href="ReadJsonNumberBenchmark.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
